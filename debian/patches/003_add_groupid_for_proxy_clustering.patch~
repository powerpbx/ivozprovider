Index: ivozprovider/kamailio/trunks/config/kamailio.cfg
===================================================================
--- ivozprovider.orig/kamailio/trunks/config/kamailio.cfg
+++ ivozprovider/kamailio/trunks/config/kamailio.cfg
@@ -9,6 +9,9 @@
 
 ####### Defines #########
 
+## A cluster requires a unique GROUP_ID for each proxy server
+#!define GROUP_ID 1
+
 #!define SIP_PORT 5060
 #!define SIPS_PORT 5061
 #!define XMLRPC_PORT 8001
@@ -49,6 +52,8 @@ config.allow_calls_without_cgrates = 0
 
 ####### Global Parameters #########
 
+server_id = GROUP_ID
+
 listen=udp:IP:SIP_PORT
 listen=tcp:IP:SIP_PORT
 listen=tls:IP:SIPS_PORT
@@ -478,7 +483,7 @@ route[IS_FROM_INSIDE] {
 #   - is_from_trunks = (src_ip == myself && !is_from_users);
 #   - is_from_carriers = none of above
 
-    if (ds_is_from_list("1") || ($si == $var(usersAddress) && $sp == "5060")) {
+    if (ds_is_from_list(GROUP_ID) || ($si == $var(usersAddress) && $sp == "5060")) {
         $var(is_from_inside) = 1; # as / users
     } else if (src_ip == myself) {
         $var(is_from_inside) = 2; # trunks
@@ -1224,7 +1229,7 @@ route[DISPATCH] {
             $var(alg) = 4;
         }
 
-        if(!ds_select_dst("1", "$var(alg)")) {
+        if(!ds_select_dst(GROUP_ID, "$var(alg)")) {
             xerr("[$dlg_var(cidhash)] DISPATCH: No destination found\n");
             send_reply("404", "No destination");
             exit;
Index: ivozprovider/kamailio/users/config/kamailio.cfg
===================================================================
--- ivozprovider.orig/kamailio/users/config/kamailio.cfg
+++ ivozprovider/kamailio/users/config/kamailio.cfg
@@ -9,6 +9,8 @@
 
 ####### Defines #########
 
+#!define GROUP_ID 1
+
 #!define TRUNKS_SIP_PORT 5060
 #!define SIP_PORT 5060
 #!define SIPS_PORT 5061
@@ -67,6 +69,8 @@ dolog.xmlrpc    = 0 desc "If 1, debug XM
 
 ####### Global Parameters #########
 
+server_id = GROUP_ID
+
 listen=udp:IP:SIP_PORT
 listen=tcp:IP:SIP_PORT
 listen=tls:IP:SIPS_PORT
@@ -509,7 +513,7 @@ request_route {
 #   - 1: request/response comes from the inside
 #   - 0: request/response comes from the outside world
 route[IS_FROM_INSIDE] {
-    if (ds_is_from_list("1") || $si == $var(trunksAddress)) {
+    if (ds_is_from_list(GROUP_ID) || $si == $var(trunksAddress)) {
         $var(is_from_inside) = 1; # as / trunks
     } else {
         $var(is_from_inside) = 0; # uacs
@@ -1027,7 +1031,7 @@ route[DISPATCH_TO_AS] {
             $var(alg) = 4;
         }
 
-        if(!ds_select_dst("1", "$var(alg)")) {
+        if(!ds_select_dst(GROUP_ID, "$var(alg)")) {
             xerr("[$dlg_var(cidhash)] DISPATCH-TO-AS: No destination found\n");
             send_reply("404", "No destination");
             exit;
Index: ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerAbstract.php
===================================================================
--- ivozprovider.orig/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerAbstract.php
+++ ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerAbstract.php
@@ -23,6 +23,10 @@ abstract class ApplicationServerAbstract
      */
     protected $name;
 
+    /**
+     * @var integer
+     */
+    protected $grpid = 1;
 
     use ChangelogTrait;
 
@@ -103,7 +107,8 @@ abstract class ApplicationServerAbstract
         Assertion::isInstanceOf($dto, ApplicationServerDto::class);
 
         $self = new static(
-            $dto->getIp()
+            $dto->getIp(),
+            $dto->getGrpid()
         );
 
         $self
@@ -132,8 +137,8 @@ abstract class ApplicationServerAbstract
 
         $this
             ->setIp($dto->getIp())
-            ->setName($dto->getName());
-
+            ->setName($dto->getName())
+            ->setGrpid($dto->getGrpid());
 
 
         $this->sanitizeValues();
@@ -149,7 +154,8 @@ abstract class ApplicationServerAbstract
     {
         return self::createDto()
             ->setIp(self::getIp())
-            ->setName(self::getName());
+            ->setName(self::getName())
+            ->setGrpid(self::getGrpid());
     }
 
     /**
@@ -159,7 +165,8 @@ abstract class ApplicationServerAbstract
     {
         return [
             'ip' => self::getIp(),
-            'name' => self::getName()
+            'name' => self::getName(),
+            'grpid' => self::getGrpid()
         ];
     }
     // @codeCoverageIgnoreStart
@@ -219,5 +226,30 @@ abstract class ApplicationServerAbstract
         return $this->name;
     }
 
+    /**
+     * Set grpid
+     *
+     * @param integer $grpid
+     *
+     * @return self
+     */
+    protected function setGrpid($grpid)
+    {
+        Assertion::notNull($grpid, 'grpid value "%s" is null, but non null value was expected.');
+        Assertion::integerish($grpid, 'grpid value "%s" is not an integer or a number castable to integer.');
+        Assertion::greaterOrEqualThan($grpid, 0, 'grpid provided "%s" is not greater or equal than "%s".');
+         $this->grpid = $grpid;
+         return $this;
+    }
+     /**
+     * Get grpid
+     *
+     * @return integer
+     */
+    public function getGrpid()
+    {
+        return $this->grpid;
+    }
+
     // @codeCoverageIgnoreEnd
 }
Index: ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerDtoAbstract.php
===================================================================
--- ivozprovider.orig/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerDtoAbstract.php
+++ ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerDtoAbstract.php
@@ -25,6 +25,10 @@ abstract class ApplicationServerDtoAbstr
      */
     private $id;
 
+    /**
+     * @var integer
+     */
+    private $grpid = 1;
 
     use DtoNormalizer;
 
@@ -45,6 +49,7 @@ abstract class ApplicationServerDtoAbstr
         return [
             'ip' => 'ip',
             'name' => 'name',
+            'grpid' => 'grpid',
             'id' => 'id'
         ];
     }
@@ -57,6 +62,7 @@ abstract class ApplicationServerDtoAbstr
         return [
             'ip' => $this->getIp(),
             'name' => $this->getName(),
+            'grpid' => $this->getGrpid(),
             'id' => $this->getId()
         ];
     }
@@ -102,6 +108,24 @@ abstract class ApplicationServerDtoAbstr
     }
 
     /**
+     * @param integer $grpid
+     *
+     * @return static
+     */
+    public function setGrpid($grpid = null)
+    {
+        $this->grpid = $grpid;
+         return $this;
+    }
+     /**
+     * @return integer
+     */
+    public function getGrpid()
+    {
+        return $this->grpid;
+    }
+
+    /**
      * @param integer $id
      *
      * @return static
Index: ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerInterface.php
===================================================================
--- ivozprovider.orig/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerInterface.php
+++ ivozprovider/library/Ivoz/Provider/Domain/Model/ApplicationServer/ApplicationServerInterface.php
@@ -25,4 +25,11 @@ interface ApplicationServerInterface ext
      * @return string | null
      */
     public function getName();
+
+    /**
+     * Get grpid
+     *
+     * @return integer
+     */
+    public function getGrpid();
 }
Index: ivozprovider/library/Ivoz/Provider/Infrastructure/Persistence/Doctrine/Mapping/ApplicationServer.ApplicationServerAbstract.orm.yml
===================================================================
--- ivozprovider.orig/library/Ivoz/Provider/Infrastructure/Persistence/Doctrine/Mapping/ApplicationServer.ApplicationServerAbstract.orm.yml
+++ ivozprovider/library/Ivoz/Provider/Infrastructure/Persistence/Doctrine/Mapping/ApplicationServer.ApplicationServerAbstract.orm.yml
@@ -7,6 +7,9 @@ Ivoz\Provider\Domain\Model\ApplicationSe
     name:
       columns:
         - name
+    grpid:
+      columns:
+        - grpid
   fields:
     ip:
       type: string
@@ -18,3 +21,9 @@ Ivoz\Provider\Domain\Model\ApplicationSe
       length: 64
       options:
         fixed: false
+    grpid:
+      type: integer
+      nullable: false
+      options:
+        unsigned: true
+        default: 1
Index: ivozprovider/library/Ivoz/Kam/Domain/Service/Dispatcher/UpdateByApplicationServer.php
===================================================================
--- ivozprovider.orig/library/Ivoz/Kam/Domain/Service/Dispatcher/UpdateByApplicationServer.php
+++ ivozprovider/library/Ivoz/Kam/Domain/Service/Dispatcher/UpdateByApplicationServer.php
@@ -56,7 +56,7 @@ class UpdateByApplicationServer implemen
 
         $kamDispatcherDto
             ->setApplicationServerId($entity->getId())
-            ->setSetid(1)
+            ->setSetid($entity->getGrpid())
             ->setDestination('sip:' . $entity->getIp() . ":6060")
             ->setDescription($entity->getName());
 
Index: ivozprovider/web/admin/application/configs/klear/model/ApplicationServers.yaml
===================================================================
--- ivozprovider.orig/web/admin/application/configs/klear/model/ApplicationServers.yaml
+++ ivozprovider/web/admin/application/configs/klear/model/ApplicationServers.yaml
@@ -11,6 +11,12 @@ production:
       type: text
       trim: both
       required: true
+    grpid:
+      title: 'Group Id'
+      type: text
+      trim: both
+      defaultValue: 1
+      required: true
     transport:
       title: _('Transport')
       type: text
Index: ivozprovider/scheme/tests/Provider/ApplicationServer/ApplicationServerLifeCycleTest.php
===================================================================
--- ivozprovider.orig/scheme/tests/Provider/ApplicationServer/ApplicationServerLifeCycleTest.php
+++ ivozprovider/scheme/tests/Provider/ApplicationServer/ApplicationServerLifeCycleTest.php
@@ -82,7 +82,8 @@ class ApplicationServerLifeCycleTest ext
         $asDto = new ApplicationServerDto();
         $asDto
             ->setIp('127.2.2.2')
-            ->setName('test002');
+            ->setName('test002')
+            ->setGrpid('2');
 
         /** @var ApplicationServer $as */
         $as = $this
@@ -215,7 +216,8 @@ class ApplicationServerLifeCycleTest ext
         (function () {
             $this
                 ->setName('UpdatedName')
-                ->setIp('127.2.2.127');
+                ->setIp('127.2.2.127')
+                ->setGrpid('3');
         })->call($as);
 
         $kamDispatcherRepository = $this->em->getRepository(Dispatcher::class);
@@ -256,7 +258,8 @@ class ApplicationServerLifeCycleTest ext
         $as = $this->addApplicationServer();
         (function () {
             $this->setName('UpdatedName')
-                 ->setIp('127.2.2.127');
+                 ->setIp('127.2.2.127')
+                 ->setGrpid('5');
         })->call($as);
 
         $kamDispatcherRepository = $this->em->getRepository(Dispatcher::class);
Index: ivozprovider/web/admin/application/configs/klear/ApplicationServersList.yaml
===================================================================
--- ivozprovider.orig/web/admin/application/configs/klear/ApplicationServersList.yaml
+++ ivozprovider/web/admin/application/configs/klear/ApplicationServersList.yaml
@@ -35,6 +35,7 @@ production:
         order: &applicationServersOrder
             name: true
             ip: true
+            grpid: true
       options:
         title: _("Options")
         screens:
